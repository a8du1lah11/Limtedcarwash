<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Limited Carwash | Cloud Admin</title>
    <style>
        :root { --red: #e63946; --dark: #121212; --card: #1e1e1e; --text: #f1f2f6; --dim: #a4b0be; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--dark); margin: 0; padding: 15px; color: var(--text); }
        .app-card { width: 100%; max-width: 400px; background: var(--card); border-radius: 20px; margin: auto; border: 1px solid #333; overflow: hidden; }
        .header { background: linear-gradient(135deg, #000, #300); padding: 25px; text-align: center; border-bottom: 3px solid var(--red); }
        .header h1 { margin: 0; font-size: 22px; color: var(--red); text-transform: uppercase; }
        .status-sync { font-size: 10px; color: #00ff00; margin-top: 5px; }
        .content { padding: 20px; }
        label { display: block; font-size: 11px; color: var(--red); margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #333; border-radius: 10px; background: #252525; color: white; font-size: 16px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-save { background: var(--red); color: white; margin-bottom: 10px; }
        .btn-wa { background: #25D366; color: white; display: none; margin-top: 10px; }
        .result-box { background: #2d2d2d; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid var(--red); display: none; }
        .badge { background: var(--red); color: white; padding: 2px 8px; border-radius: 5px; float: right; font-size: 12px; }
    </style>
</head>
<body onload="syncFromCloud()">

<div class="app-card">
    <div class="header">
        <h1>Limited Carwash</h1>
        <div id="syncStatus" class="status-sync">Cloud Connected</div>
    </div>
    
    <div class="content">
        <label>Plate Number</label>
        <input type="text" id="plate" placeholder="ABC-123" oninput="lookup()">

        <div id="newInputs">
            <label>Car Model</label>
            <input type="text" id="model" placeholder="e.g. Mercedes C200">
            <label>Customer Name</label>
            <input type="text" id="name" placeholder="Name">
            <label>WhatsApp (with Country Code)</label>
            <input type="tel" id="phone" placeholder="e.g. 964750...">
        </div>

        <div id="resultBox" class="result-box">
            <span id="resVisits" class="badge"></span>
            <p><b>Owner:</b> <span id="resName"></span></p>
            <p><b>Model:</b> <span id="resModel"></span></p>
        </div>

        <button class="btn btn-save" onclick="saveData()">Check-In & Cloud Sync</button>
        <button id="waBtn" class="btn btn-wa" onclick="sendWhatsApp()">üì± Send Done Message</button>
    </div>
</div>

<script>
    const DB_NAME = "LIMITED_CW_DATABASE";
    // *** PASTE YOUR GOOGLE URL BELOW ***
    const CLOUD_URL = "https://script.google.com/macros/s/AKfycbyOPE9-yQoB2fviysepH9VOGBr5tIz1_n3vpU-t_upQDzy54Qr5Qtymsi8BzbXOX_cIKA/exec"; 

    function getDB() { return JSON.parse(localStorage.getItem(DB_NAME)) || {}; }

    async function syncFromCloud() {
        document.getElementById('syncStatus').innerText = "Syncing...";
        try {
            const response = await fetch(CLOUD_URL);
            const cloudData = await response.json();
            localStorage.setItem(DB_NAME, JSON.stringify(cloudData));
            document.getElementById('syncStatus').innerText = "Cloud Synced ‚úÖ";
        } catch (e) {
            document.getElementById('syncStatus').innerText = "Offline Mode ‚ö†Ô∏è";
        }
    }

    function lookup() {
        const plate = document.getElementById('plate').value.toUpperCase().trim();
        const db = getDB();
        const resBox = document.getElementById('resultBox');
        const newInputs = document.getElementById('newInputs');
        const waBtn = document.getElementById('waBtn');

        if (db[plate]) {
            const user = db[plate];
            newInputs.style.display = 'none';
            resBox.style.display = 'block';
            waBtn.style.display = 'block';
            document.getElementById('resName').innerText = user.name;
            document.getElementById('resModel').innerText = user.model;
            document.getElementById('resVisits').innerText = "Visits: " + user.visits;
            window.activeCustomer = { ...user, plate: plate };
        } else {
            newInputs.style.display = 'block';
            resBox.style.display = 'none';
            waBtn.style.display = 'none';
            window.activeCustomer = null;
        }
    }

    async function saveData() {
        const plate = document.getElementById('plate').value.toUpperCase().trim();
        const db = getDB();
        let name, phone, model, visits;

        if (window.activeCustomer) {
            name = window.activeCustomer.name;
            phone = window.activeCustomer.phone;
            model = window.activeCustomer.model;
            visits = parseInt(window.activeCustomer.visits) + 1;
        } else {
            name = document.getElementById('name').value;
            phone = document.getElementById('phone').value.replace(/\D/g,'');
            model = document.getElementById('model').value;
            visits = 1;
        }

        const data = { plate, name, phone, model, visits };
        db[plate] = data;
        localStorage.setItem(DB_NAME, JSON.stringify(db));

        // Send to Google Sheets
        fetch(CLOUD_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
        
        alert(`Success! Visit #${visits} for ${name}`);
        lookup();
    }

    function sendWhatsApp() {
        if (!window.activeCustomer) return;
        const c = window.activeCustomer;
        const msg = `*LIMITED CARWASH*%0A%0AHello ${c.name},%0AYour car is ready for pickup!%0A%0A*Car:* ${c.model}%0A*Plate:* ${c.plate}%0A*Total Visits:* ${c.visits}%0A%0AThank you!`;
        window.open(`https://wa.me/${c.phone}?text=${msg}`, '_blank');
    }
</script>
</body>
</html>
