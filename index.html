<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Car Wash Pro Admin</title>
    <style>
        :root { --primary: #007bff; --success: #25D366; --dark: #1e272e; --bg: #f1f2f6; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .app-card { width: 100%; max-width: 400px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: var(--dark); color: white; padding: 20px; text-align: center; }
        .header h1 { margin: 0; font-size: 20px; }
        .content { padding: 20px; }
        label { display: block; font-size: 11px; font-weight: bold; color: #888; margin-bottom: 5px; text-transform: uppercase; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #eee; border-radius: 10px; box-sizing: border-box; font-size: 16px; outline: none; }
        input:focus { border-color: var(--primary); }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-save { background: var(--primary); color: white; margin-bottom: 10px; }
        .btn-wa { background: var(--success); color: white; display: none; }
        .result-box { background: #eef5ff; padding: 15px; border-radius: 12px; margin-top: 10px; border: 1px solid #cce3ff; display: none; }
        .info-text { margin: 5px 0; font-size: 15px; }
        .badge { background: var(--primary); color: white; padding: 2px 8px; border-radius: 5px; font-size: 12px; }
    </style>
</head>
<body>

<div class="app-card">
    <div class="header"><h1>WASH STATION ADMIN</h1></div>
    <div class="content">
        
        <label>Plate Number</label>
        <input type="text" id="plate" placeholder="e.g. ABC-1234" oninput="lookup()">

        <div id="newInputs">
            <label>Car Model</label>
            <input type="text" id="model" placeholder="e.g. Toyota Camry">
            <label>Customer Name</label>
            <input type="text" id="name" placeholder="Full Name">
            <label>WhatsApp (with country code)</label>
            <input type="tel" id="phone" placeholder="e.g. 15551234567">
        </div>

        <div id="resultBox" class="result-box">
            <p class="info-text"><b>Owner:</b> <span id="resName"></span></p>
            <p class="info-text"><b>Car:</b> <span id="resModel"></span></p>
            <p class="info-text"><b>Visits:</b> <span id="resVisits" class="badge"></span></p>
        </div>

        <button class="btn btn-save" onclick="saveData()">Check-In & Save</button>
        <button id="waBtn" class="btn btn-wa" onclick="sendWhatsApp()">ðŸ“± Send Done Message</button>
    </div>
</div>

<script>
    const DB_NAME = "CARWASH_DB_V2";

    function getDB() {
        return JSON.parse(localStorage.getItem(DB_NAME)) || {};
    }

    function lookup() {
        const plate = document.getElementById('plate').value.toUpperCase().trim();
        const db = getDB();
        const resBox = document.getElementById('resultBox');
        const newInputs = document.getElementById('newInputs');
        const waBtn = document.getElementById('waBtn');

        if (db[plate]) {
            const user = db[plate];
            newInputs.style.display = 'none';
            resBox.style.display = 'block';
            waBtn.style.display = 'block';
            
            document.getElementById('resName').innerText = user.name;
            document.getElementById('resModel').innerText = user.model;
            document.getElementById('resVisits').innerText = user.visits;
            window.activeCustomer = { ...user, plate: plate };
        } else {
            newInputs.style.display = 'block';
            resBox.style.display = 'none';
            waBtn.style.display = 'none';
            window.activeCustomer = null;
        }
    }

    function saveData() {
        const plate = document.getElementById('plate').value.toUpperCase().trim();
        const db = getDB();
        let name, phone, model, visits;

        if (window.activeCustomer) {
            name = window.activeCustomer.name;
            phone = window.activeCustomer.phone;
            model = window.activeCustomer.model;
            visits = window.activeCustomer.visits + 1;
        } else {
            name = document.getElementById('name').value.trim();
            phone = document.getElementById('phone').value.trim().replace(/\D/g,'');
            model = document.getElementById('model').value.trim();
            visits = 1;

            if (!plate || !name || !phone || !model) {
                alert("Please fill all fields for new registration!");
                return;
            }
        }

        db[plate] = { name, phone, model, visits };
        localStorage.setItem(DB_NAME, JSON.stringify(db));
        alert("Check-in successful! Visit #" + visits);
        lookup();
    }

    function sendWhatsApp() {
        if (!window.activeCustomer) return;
        
        const customer = window.activeCustomer;
        // The automatic message template:
        const message = `Hello ${customer.name}! ðŸš— Your ${customer.model} (${customer.plate}) is washed and ready for pickup. This was your visit #${customer.visits}. Thank you!`;
        
        const url = `https://wa.me/${customer.phone}?text=${encodeURIComponent(message)}`;
        window.open(url, '_blank');
    }
</script>

</body>
</html>
