<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Limited Carwash | Cloud Sync</title>
    <style>
        :root { --red: #e63946; --dark: #121212; --card: #1e1e1e; --text: #f1f2f6; --dim: #a4b0be; }
        body { 
            font-family: 'Segoe UI', sans-serif; background: var(--dark); 
            background-image: linear-gradient(rgba(18, 18, 18, 0.9), rgba(18, 18, 18, 0.9)), url('https://images.unsplash.com/photo-1520333781090-e2516332b107?q=80&w=1000');
            background-size: cover; background-position: center; background-attachment: fixed;
            margin: 0; padding: 15px; color: var(--text); 
        }
        .app-card { width: 100%; max-width: 420px; background: var(--card); border-radius: 25px; margin: auto; border: 1px solid #444; overflow: hidden; box-shadow: 0 15px 50px rgba(0,0,0,0.8); }
        .header { background: linear-gradient(135deg, #000, #400); padding: 25px; text-align: center; border-bottom: 3px solid var(--red); }
        .header h1 { margin: 0; font-size: 24px; color: var(--red); text-transform: uppercase; }
        .status-sync { font-size: 11px; padding: 5px; font-weight: bold; }
        .sync-ok { color: #00ff00; }
        .sync-loading { color: #f1c40f; }
        .content { padding: 20px; }
        label { display: block; font-size: 11px; color: var(--dim); margin-bottom: 5px; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #333; border-radius: 10px; background: #252525; color: white; font-size: 16px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-save { background: var(--red); color: white; }
        .result-box { background: #2d2d2d; padding: 15px; border-radius: 15px; border-left: 5px solid var(--red); display: none; margin-bottom: 15px; }
        .badge { background: var(--red); color: white; padding: 4px 10px; border-radius: 8px; float: right; font-size: 12px; }
    </style>
</head>
<body onload="syncData()">

<div class="app-card">
    <div class="header">
        <h1>Limited Carwash</h1>
        <div id="syncStatus" class="status-sync sync-loading">üîÑ Connecting to Cloud...</div>
    </div>
    
    <div class="content">
        <label>Plate Number</label>
        <input type="text" id="plate" placeholder="24a1234" oninput="lookup()">

        <div id="resultBox" class="result-box">
            <span id="resVisits" class="badge"></span>
            <p><b>Owner:</b> <span id="resName"></span></p>
            <p><b>Model:</b> <span id="resModel"></span></p>
        </div>

        <div id="newInputs">
            <label>Car Model</label>
            <input type="text" id="model" placeholder="Model">
            <label>Customer Name</label>
            <input type="text" id="name" placeholder="Name">
            <label>WhatsApp Number</label>
            <input type="tel" id="phone" placeholder="964750...">
        </div>

        <button class="btn btn-save" onclick="saveData()">Save & Sync</button>
    </div>
</div>

<script>
    const DB_NAME = "LIMITED_CW_DATABASE";
    // *** PASTE YOUR NEW DEPLOYMENT URL HERE ***
    const CLOUD_URL = "https://script.google.com/macros/s/AKfycby6zDeJNfxyUY4dKx0V1MbAehB0yuCBtwE0hXQCxQRofdoebwnyOtbNyZR33oNsJsxvkA/exec"; 

    function getDB() { return JSON.parse(localStorage.getItem(DB_NAME)) || {}; }

    async function syncData() {
        const status = document.getElementById('syncStatus');
        try {
            const response = await fetch(CLOUD_URL);
            const data = await response.json();
            localStorage.setItem(DB_NAME, JSON.stringify(data));
            status.innerText = "Cloud Synced ‚úÖ (All devices up to date)";
            status.className = "status-sync sync-ok";
        } catch (e) {
            status.innerText = "Offline Mode ‚ö†Ô∏è (Using local memory)";
        }
    }

    function lookup() {
        const plate = document.getElementById('plate').value.toUpperCase().trim();
        const db = getDB();
        const resBox = document.getElementById('resultBox');
        const newInputs = document.getElementById('newInputs');

        if (db[plate]) {
            const user = db[plate];
            newInputs.style.display = 'none';
            resBox.style.display = 'block';
            document.getElementById('resName').innerText = user.name;
            document.getElementById('resModel').innerText = user.model;
            document.getElementById('resVisits').innerText = "Visits: " + user.visits;
            window.activeCustomer = { ...user, plate: plate };
        } else {
            newInputs.style.display = 'block';
            resBox.style.display = 'none';
            window.activeCustomer = null;
        }
    }

    async function saveData() {
        const plate = document.getElementById('plate').value.toUpperCase().trim();
        const db = getDB();
        let data;

        if (window.activeCustomer) {
            data = { ...window.activeCustomer, visits: parseInt(window.activeCustomer.visits) + 1 };
        } else {
            data = {
                plate: plate,
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value.replace(/\D/g,''),
                model: document.getElementById('model').value,
                visits: 1
            };
        }

        db[plate] = data;
        localStorage.setItem(DB_NAME, JSON.stringify(db));

        // Sync to Cloud
        await fetch(CLOUD_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
        
        alert("Saved to Cloud!");
        lookup();
    }
</script>
</body>
</html>
